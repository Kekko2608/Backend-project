@model Progetto_Pizzeria.Models.Ordine

<h1>Dettagli Ordine</h1>

@if (Model == null)
{
    <div class="alert alert-warning">Nessun ordine trovato.</div>
}
else
{
    <div class="card text-black">
        <div class="card-body">
            <h5 class="card-title">Ordine #@Model.Id</h5>
            <p><strong>Note Aggiuntive:</strong> @Model.Noteaggiuntive</p>
            <p><strong>Stato:</strong> @(Model.Evaso ? "Evaso" : "In Attesa")</p>

            <h4>Prodotti Ordinati</h4>
            <table class="table">
                <thead>
                    <tr>
                        <th>Nome Prodotto</th>
                        <th>Quantità</th>
                        <th>Prezzo</th>
                        <th>Azioni</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.ProdottiOrdinati != null && Model.ProdottiOrdinati.Any())
                    {
                        @foreach (var prodottoOrdinato in Model.ProdottiOrdinati)
                        {
                            <tr>
                                <td>@prodottoOrdinato.Prodotto.Nome</td>
                                <td>@prodottoOrdinato.Quantita</td>
                                <td>@(prodottoOrdinato.Prodotto.Prezzo * prodottoOrdinato.Quantita)€</td>
                                <td>
                                    <form method="post" action="@Url.Action("RimuoviProdotto", "Ordine")" style="display:inline;">
                                        <input type="hidden" name="prodottoOrdinatoId" value="@prodottoOrdinato.Id" />
                                        <button type="submit" class="btn btn-sm">Elimina</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4" class="text-center">Nessun prodotto ordinato</td>
                        </tr>
                    }
                </tbody>
            </table>

            <!-- Calcolo del Totale -->
            <div class="d-flex justify-content-end">
                <h5 class="mr-3">
                    Totale:
                    @(
                        Model.ProdottiOrdinati.Sum(po => po.Prodotto.Prezzo * po.Quantita)
                        )
                    €
                </h5>
            </div>

            @if (!Model.Evaso)
            {
                <form method="post" action="@Url.Action("ConfermaOrdine", "Ordine")">
                    <input type="hidden" name="ordineId" value="@Model.Id" />
                    <div class="form-group">
                        <label for="indirizzo">Indirizzo di Consegna:</label>
                        <input type="text" class="form-control" id="indirizzo" name="indirizzo" required />
                    </div>
                    <div class="form-group">
                        <label for="noteAggiuntive">Note Aggiuntive:</label>
                        <textarea class="form-control" id="noteAggiuntive" name="noteAggiuntive"></textarea>
                    </div>
                    <button type="submit" class="btn text-black mt-3">Conferma Ordine</button>
                </form>
            }
            else
            {
                <div class="alert alert-success mt-3">L'ordine è stato già confermato e non può essere modificato.</div>
            }
        </div>
    </div>
}
@section Scripts {
    <script>
        $(document).ready(function () {
            var successMessage = '@TempData["SuccessMessage"]';
            if (successMessage) {
                alert(successMessage);
            }
        });
    </script>
}
